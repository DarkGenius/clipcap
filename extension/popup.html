<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>ClipCap</title>
    <style>
      body {
        font-family: system-ui;
        margin: 16px;
        width: 480px;
      }
      button {
        padding: 8px 12px;
        margin: 4px 0;
      }
      input {
        width: 100%;
        padding: 6px;
        margin: 4px 0;
      }
      pre {
        background: #f6f6f6;
        padding: 8px;
        border-radius: 6px;
        max-height: 240px;
        overflow: auto;
      }
      .muted {
        color: #666;
        font-size: 12px;
      }
      .section {
        border-top: 1px solid #ddd;
        padding-top: 12px;
        margin-top: 12px;
      }
      .m3u8-list {
        max-height: 200px;
        overflow-y: auto;
        background: #f6f6f6;
        padding: 8px;
        border-radius: 6px;
      }
      .m3u8-item {
        font-size: 11px;
        margin: 6px 0;
        padding: 6px;
        background: white;
        border-radius: 4px;
        word-break: break-all;
      }
      .m3u8-item .url {
        color: #0066cc;
        margin-bottom: 4px;
      }
      .m3u8-item .time {
        color: #999;
        font-size: 10px;
      }
      .m3u8-item .check-btn {
        padding: 3px 8px;
        font-size: 10px;
        margin-top: 4px;
        margin-right: 4px;
        background: #f0f0f0;
        color: #333;
        border: 1px solid #ddd;
        border-radius: 3px;
        cursor: pointer;
      }
      .m3u8-item .check-btn:hover {
        background: #e0e0e0;
      }
      .m3u8-item .check-btn:disabled {
        background: #f5f5f5;
        color: #999;
        cursor: not-allowed;
      }
      .m3u8-item .download-btn {
        padding: 3px 10px;
        font-size: 10px;
        margin-top: 4px;
        background: #4caf50;
        color: white;
        border: none;
        border-radius: 3px;
        cursor: pointer;
      }
      .m3u8-item .download-btn:hover {
        background: #45a049;
      }
      .m3u8-item .download-btn:disabled {
        background: #ccc;
        cursor: not-allowed;
      }
      .m3u8-item .info {
        margin-top: 4px;
        padding: 4px;
        background: #f0f0f0;
        border-radius: 3px;
        font-size: 10px;
      }
      .m3u8-item .info.success {
        background: #e8f5e9;
        color: #2e7d32;
      }
      .m3u8-item .info.error {
        background: #ffebee;
        color: #c62828;
      }
      .m3u8-item .progress {
        margin-top: 4px;
      }
      .m3u8-item .progress-bar {
        width: 100%;
        height: 20px;
        background: #f0f0f0;
        border-radius: 4px;
        position: relative;
        overflow: hidden;
      }
      .m3u8-item .progress-fill {
        position: absolute;
        left: 0;
        top: 0;
        height: 100%;
        background: #4caf50;
        transition: width 0.3s;
      }
      .m3u8-item .progress-text {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #333;
        font-size: 11px;
        font-weight: 600;
      }
      .m3u8-item .cancel-btn {
        padding: 4px 8px;
        font-size: 10px;
        margin-top: 4px;
        background: #f44336;
        color: white;
        border: none;
        cursor: pointer;
      }
      .m3u8-item .cancel-btn:hover {
        background: #d32f2f;
      }
      .m3u8-item .cancel-btn:disabled {
        background: #ccc;
        cursor: not-allowed;
      }
      .empty-state {
        text-align: center;
        color: #999;
        padding: 20px;
      }
      .settings-content {
        display: none;
        margin-top: 12px;
      }
      .settings-content.visible {
        display: block;
      }
      .compact-btn {
        background: #f0f0f0;
        color: #333;
        font-size: 10px;
        padding: 4px 8px;
        cursor: pointer;
        border: 1px solid #ddd;
        border-radius: 3px;
      }
      .compact-btn:hover {
        background: #e0e0e0;
      }
      .gear-btn {
        background: none;
        border: none;
        font-size: 20px;
        cursor: pointer;
        padding: 4px 8px;
        color: #666;
      }
      .gear-btn:hover {
        color: #333;
        background: #f0f0f0;
        border-radius: 4px;
      }
      .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
      }
      .modal-overlay.visible {
        display: flex;
      }
      .modal-content {
        background: white;
        padding: 20px;
        border-radius: 8px;
        width: 440px;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        position: relative;
      }
      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
      }
      .modal-header h3 {
        margin: 0;
      }
      .modal-close {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: #666;
        padding: 0;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .modal-close:hover {
        color: #333;
        background: #f0f0f0;
        border-radius: 50%;
      }
      .header-with-gear {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 12px;
      }
      .tabs {
        display: flex;
        gap: 4px;
        margin-bottom: 12px;
        border-bottom: 2px solid #ddd;
      }
      .tab-btn {
        flex: 1;
        padding: 8px 12px;
        background: none;
        border: none;
        cursor: pointer;
        font-size: 12px;
        color: #666;
        border-bottom: 2px solid transparent;
        margin-bottom: -2px;
      }
      .tab-btn:hover {
        background: #f0f0f0;
      }
      .tab-btn.active {
        color: #333;
        font-weight: 600;
        border-bottom-color: #4caf50;
      }
      .tab-content {
        display: none;
      }
      .tab-content.active {
        display: block;
      }
      .download-item {
        margin: 8px 0;
        padding: 8px;
        background: #f9f9f9;
        border-radius: 4px;
        border: 1px solid #e0e0e0;
        position: relative;
      }
      .download-item .url {
        color: #0066cc;
        font-size: 11px;
        margin-bottom: 4px;
        word-break: break-all;
      }
      .download-item .filename {
        color: #666;
        font-size: 10px;
        margin-bottom: 4px;
      }
      .downloads-section {
        margin-bottom: 16px;
      }
      .downloads-section h3 {
        font-size: 13px;
        margin: 8px 0;
        color: #555;
      }
      .download-item.completed {
        background: #f0f8f0;
        border-color: #c8e6c9;
        padding-right: 32px;
      }
      .download-item.completed .filename {
        color: #2e7d32;
      }
      .download-item .filepath {
        color: #999;
        font-size: 9px;
        margin-bottom: 6px;
        word-break: break-all;
      }
      .download-item .remove-btn {
        position: absolute;
        top: 6px;
        right: 6px;
        width: 18px;
        height: 18px;
        padding: 0;
        background: #999;
        color: white;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        font-size: 14px;
        line-height: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0.6;
        transition: opacity 0.2s, background 0.2s;
      }
      .download-item .remove-btn:hover {
        background: #666;
        opacity: 1;
      }
      .download-item .completed-actions {
        margin-top: 6px;
        display: flex;
        gap: 4px;
      }
      .download-item .open-btn {
        padding: 4px 12px;
        font-size: 10px;
        background: #2196f3;
        color: white;
        border: none;
        border-radius: 3px;
        cursor: pointer;
      }
      .download-item .open-btn:hover {
        background: #1976d2;
      }
      .download-item .open-btn:disabled {
        background: #ccc;
        cursor: not-allowed;
      }
      .download-item .progress {
        margin-top: 6px;
        display: flex;
        align-items: center;
        gap: 6px;
      }
      .download-item .progress-bar {
        flex: 1;
        height: 20px;
        background: #f0f0f0;
        border-radius: 4px;
        position: relative;
        overflow: hidden;
      }
      .download-item .progress-fill {
        position: absolute;
        left: 0;
        top: 0;
        height: 100%;
        background: #4caf50;
        transition: width 0.3s;
      }
      .download-item .progress-text {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #333;
        font-size: 11px;
        font-weight: 600;
      }
      .download-item .cancel-btn {
        padding: 4px 10px;
        font-size: 10px;
        background: #f44336;
        color: white;
        border: none;
        border-radius: 3px;
        cursor: pointer;
        white-space: nowrap;
      }
      .download-item .cancel-btn:hover {
        background: #d32f2f;
      }
      .download-item .cancel-btn:disabled {
        background: #ccc;
        cursor: not-allowed;
      }
    </style>
  </head>
  <body>
    <div class="header-with-gear">
      <h3 style="margin: 0">ClipCap</h3>
      <button id="btn-open-settings" class="gear-btn" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">
        ‚öôÔ∏è
      </button>
    </div>

    <div class="tabs">
      <button class="tab-btn active" data-tab="current-page">
        –¢–µ–∫—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
      </button>
      <button class="tab-btn" data-tab="downloads">
        –ó–∞–≥—Ä—É–∑–∫–∏ (<span id="active-downloads-count">0</span>)
      </button>
    </div>

    <div id="tab-current-page" class="tab-content active">
      <div class="section">
        <h3>–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ .m3u8 –∑–∞–ø—Ä–æ—Å–æ–≤</h3>
        <div class="muted" style="margin-bottom: 8px">
          –¢–µ–∫—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞:
          <span
            id="current-page"
            style="color: #0066cc; font-size: 10px; word-break: break-all"
            >–∑–∞–≥—Ä—É–∑–∫–∞...</span
          >
        </div>
        <div style="display: flex; gap: 6px; margin-bottom: 8px">
          <button id="btn-refresh-m3u8" class="compact-btn">
            –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫
          </button>
          <button id="btn-clear-m3u8" class="compact-btn">
            –û—á–∏—Å—Ç–∏—Ç—å –¥–ª—è —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
          </button>
        </div>
        <div class="muted">
          –ù–∞–π–¥–µ–Ω–Ω—ã–µ .m3u8 URL (<span id="m3u8-count">0</span>):
        </div>
        <div id="m3u8-list" class="m3u8-list">
          <div class="empty-state">
            –ù–∞ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ .m3u8 –∑–∞–ø—Ä–æ—Å–æ–≤
          </div>
        </div>
      </div>
    </div>

    <div id="tab-downloads" class="tab-content">
      <div class="section">
        <h3>–ó–∞–≥—Ä—É–∑–∫–∏</h3>
        <div style="display: flex; gap: 6px; margin-bottom: 8px">
          <button id="btn-refresh-downloads" class="compact-btn">
            –û–±–Ω–æ–≤–∏—Ç—å
          </button>
        </div>
        <div id="downloads-list">
          <div class="empty-state">–ù–µ—Ç –∑–∞–≥—Ä—É–∑–æ–∫</div>
        </div>
      </div>
    </div>

    <div class="section">
      <div style="margin-bottom: 8px">
        <button id="btn-toggle-logs" class="compact-btn">
          üìã –õ–æ–≥–∏ –æ—Ç–ª–∞–¥–∫–∏
        </button>
      </div>
      <div id="logs-content" class="settings-content">
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
          "
        >
          <div class="muted">–õ–æ–≥–∏ –æ—Ç–ª–∞–¥–∫–∏:</div>
          <button id="btn-clear-log" style="padding: 2px 8px; font-size: 10px">
            –û—á–∏—Å—Ç–∏—Ç—å
          </button>
        </div>
        <pre id="log"></pre>
      </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
    <div id="settings-modal" class="modal-overlay">
      <div class="modal-content">
        <div class="modal-header">
          <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
          <button id="btn-close-settings" class="modal-close">√ó</button>
        </div>
        <div>
          <label>–ü—É—Ç—å –∫ yt-dlp:</label>
          <input id="ytdlp-path" placeholder="E:\yt-dlp\yt-dlp.exe" />
          <label style="margin-top: 8px; display: block"
            >–ü—É—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–∏–¥–µ–æ:</label
          >
          <input id="ytdlp-output" placeholder="E:\yt-dlp" />
          <button id="btn-save-settings" style="margin-top: 12px">
            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
          </button>
        </div>
      </div>
    </div>

    <script src="popup.js"></script>
  </body>
</html>
